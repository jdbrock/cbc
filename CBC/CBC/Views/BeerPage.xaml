<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:Xamarin.Forms.Labs.Controls;assembly=XLabs.Forms"
             xmlns:this="clr-namespace:CBC;assembly=CBC"
             xmlns:sfr="clr-namespace:Syncfusion.SfRating.XForms;assembly=Syncfusion.SfRating.XForms"
             x:Class="CBC.BeerPage" Padding="0,21,0,0">

  <ContentPage.Resources>
    <ResourceDictionary>
      <this:SessionToColorConverter x:Key="SessionToColorConverter" />
      <this:RatingConverter x:Key="RatingConverter" />
    </ResourceDictionary>
  </ContentPage.Resources>

  <!--<ContentPage.ToolbarItems>
    <ToolbarItem Name="A-Z" Order="Secondary" Priority="0" Command="{Binding OrderAZCommand}" />
    <ToolbarItem Name="Fav" Order="Secondary" Priority="0" Command="{Binding OrderFavCommand}" />
  </ContentPage.ToolbarItems>-->

  <StackLayout>
    <SearchBar SearchCommand="{Binding SearchCommand}" Text="{Binding SearchText}" />

    <ListView ItemsSource="{Binding FilteredBeers}" RowHeight="76" ItemTapped="OnBeerTapped" ItemSelected="OnBeerSelected" Refreshing="OnRefreshing" IsPullToRefreshEnabled="true" GroupDisplayBinding="{Binding StyleName}" SeparatorColor="#eeeeee" SeparatorVisibility="None">
      <ListView.ItemTemplate>
        <DataTemplate>
          <!--<TextCell Text="{Binding BreweryAndBeerName}" />-->
          <ViewCell>
<!--            <ViewCell.ContextActions>
              <MenuItem Clicked="OnBeerFavorite" Text="Favorite" IsDestructive="False" />
            </ViewCell.ContextActions>-->
            <Grid HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="21" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>

              <Grid Grid.Column="0" Padding="5,0,0,10">
                <BoxView BackgroundColor="{Binding Beer.SessionNumber, Converter={StaticResource SessionToColorConverter}}" VerticalOptions="FillAndExpand" WidthRequest="16" />
              </Grid>

              <!--<StackLayout Grid.Row="0" Grid.Column="1" Padding="12" VerticalOptions="Center">
              <Image Source="{Binding MetaData.StatusImageUri}" />
            </StackLayout>-->

              <StackLayout Orientation="Vertical" Grid.Column="2" Padding="0,0,5,10" HorizontalOptions="StartAndExpand">
                <Label Text="{Binding Beer.BreweryName}"  LineBreakMode="TailTruncation" FontSize="Medium" FontAttributes="Bold" />
                <Label Text="{Binding Beer.BeerName}"     LineBreakMode="TailTruncation" FontSize="Small" />
                <Label Text="{Binding Beer.ABVAndStyle}"  LineBreakMode="TailTruncation" FontSize="Micro" Opacity="0.5" />
              </StackLayout>

              <Grid Grid.Column="3" Padding="0,20,0,0" VerticalOptions="FillAndExpand" HorizontalOptions="End" WidthRequest="180" IsVisible="{Binding IsExpanded}">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>
      			<sfr:SfRating Grid.Column="0" Precision="Exact" Value="{Binding Beer.MetaData.TickRating, Mode=TwoWay, Converter={StaticResource RatingConverter}}" ItemSize="24" VerticalOptions="Center" ValueChanged="OnRatingValueChanged" />
      			<Label Grid.Column="1" Text="{Binding Beer.MetaData.TickRating}" Margin="10,0,10,30" VerticalOptions="Center" />
              </Grid>
<!--
              <Grid Grid.Column="4" Padding="0,10,0,0" VerticalOptions="FillAndExpand" HorizontalOptions="End" WidthRequest="40" IsVisible="{Binding IsExpanded}">
              	<Button Text="Save" />
              </Grid>-->

              <!--<Label Grid.Row="0" Grid.Column="2" Text="{Binding LocationNumber}" FontSize="Medium" Opacity="0.5" XAlign="End" />
                        <Label Grid.Row="1" Grid.Column="2" Text="{Binding LocationDirection}" FontSize="Micro" Opacity="0.3" XAlign="End" />-->
              <!--<Label Grid.Row="2" Grid.Column="2" Text="{Binding DateExpiry,   StringFormat='{0:yyyy-MM-dd}'}" FontSize="Micro" Opacity="0.5" />-->
            </Grid>

            <!--<StackLayout HorizontalOptions="StartAndExpand" Orientation="Horizontal">
                      <StackLayout Padding="5,0,0,0" VerticalOptions="StartAndExpand" Orientation="Vertical">
                        <Label Text="{Binding .}" YAlign="Center" FontSize="Medium" />
                        <Label Text="hint: trigger a context action" YAlign="Center" FontSize="Small" />
                      </StackLayout>
                    </StackLayout>-->
          </ViewCell>
        </DataTemplate>
      </ListView.ItemTemplate>
    </ListView>
  </StackLayout>

</ContentPage>